<script>
function goFullscreen() {
  const el = document.getElementById("game");
  if (el.requestFullscreen) el.requestFullscreen();
}

document.getElementById("rom").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;

  document.getElementById("game").innerHTML = "";

  const url = URL.createObjectURL(file);
  const system = document.getElementById("system").value;

  // REQUIRED EmulatorJS config
  window.EJS_player = "#game";
  window.EJS_gameUrl = url;
  window.EJS_core = system;
  window.EJS_pathtodata = "https://cdn.emulatorjs.org/stable/data/";
  window.EJS_startOnLoaded = true;
  window.EJS_biosUrl = ""; // IMPORTANT for NES
  window.EJS_disableDatabases = true;

  // Remove old loader
  const old = document.getElementById("ejs");
  if (old) old.remove();

  // Load EmulatorJS AFTER config
  const script = document.createElement("script");
  script.src = "https://cdn.emulatorjs.org/stable/data/loader.js";
  script.id = "ejs";
  document.body.appendChild(script);
});
</script>
